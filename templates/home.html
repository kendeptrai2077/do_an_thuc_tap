<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nh·∫≠n d·∫°ng ch·ªØ vi·∫øt</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="header-container">
            <div class="menu-icon" onclick="toggleMenu()" aria-label="M·ªü menu ƒëi·ªÅu h∆∞·ªõng">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <h1>Nh·∫≠n Di·ªán Ch·ªØ Vi·∫øt</h1>
            <div class="login-btn">
            </div>
            <nav id="menu" class="hidden">
                <ul>
                    <li><a href="/home">Trang ch·ªß</a></li>
                    <li><a href="/profile">Profile</a></li>
                    <li><a href="/about">Gi·ªõi thi·ªáu</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <h2>Chuy·ªÉn ƒë·ªïi ch·ªØ vi·∫øt th√†nh vƒÉn b·∫£n d·ªÖ d√†ng</h2>
            <p>Nh·∫≠n di·ªán ch·ªØ vi·∫øt tay ho·∫∑c ch·ªØ in t·ª´ ·∫£nh ho·∫∑c camera v·ªõi ƒë·ªô ch√≠nh x√°c cao.</p>
        </section>

        <section class="upload-section">
            <div class="button-container">
                <button onclick="document.getElementById('fileInput').click()" class="btn btn-primary">
                    <span class="icon">üìÇ</span> T·∫£i ·∫£nh
                </button>
                <input type="file" id="fileInput" accept="image/*" style="display:none;" onchange="previewImage(event)">
                <button onclick="startPainting()" class="btn btn-secondary">
                    <span class="icon">üì∏</span> V·∫Ω ch·ªØ
                </button>
                <button onclick="clearCanvas()" class="btn btn-danger">
                    <span class="icon">üóëÔ∏è</span> X√≥a
                </button>                
                <canvas id="drawingCanvas" width="400" height="200" style="border: 1px solid #000; display: none;"></canvas>

                <button onclick="exportToFile()" class="btn btn-danger">
                    <span class="icon">üóëÔ∏è</span> Xu·∫•t file
                </button>
                <button onclick="submitImage()" class="btn btn-success">
                    <span class="icon">‚úÖ</span> Duy·ªát ·∫£nh
                </button>
            </div>

            <div class="upload-container">
                <video id="camera" autoplay style="display: none;"></video>
                <canvas id="canvas" style="display: none;"></canvas>
                <img id="preview" style="display: none; max-width: 100%; height: auto;" alt="·∫¢nh ƒë√£ t·∫£i l√™n">
                <canvas id="drawingCanvas" width="400" height="200" style="border: 1px solid #000; display: none;"></canvas>
            </div>

            <div class="result-container" id="result" style="display: none;">
                <h3>K·∫øt qu·∫£ nh·∫≠n di·ªán</h3>
                <div id="result-content" class="result-text"></div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>Blog: C·∫≠p nh·∫≠t th√¥ng tin v·ªÅ AI & Nh·∫≠n di·ªán ch·ªØ vi·∫øt</p>
        
        <!-- Th√™m th√¥ng tin li√™n h·ªá -->
        <div class="footer-contact">
            <p><strong>Li√™n h·ªá:</strong> <a href="mailto:info@example.com">83@gmaill.com</a></p>
            <p><strong>ƒêi·ªán tho·∫°i:</strong> 0938712384</p>
        </div>
    
        <!-- Th√™m c√°c li√™n k·∫øt m·∫°ng x√£ h·ªôi -->
        <div class="footer-socials">
            <a href="https://www.facebook.com" target="_blank">Facebook</a>
            <a href="https://www.twitter.com" target="_blank">Twitter</a>
            <a href="https://www.linkedin.com" target="_blank">LinkedIn</a>
        </div>
    
        <!-- Th√™m b·∫£n quy·ªÅn -->
        <div class="footer-copyright">
            <p>&copy; 2025 Nh·∫≠n di·ªán ch·ªØ vi·∫øt. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
        </div>
    </footer>
    

    <script>
        let isPainting = false;
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');

        function startPainting() {
            // Hi·ªÉn th·ªã canvas khi nh·∫•n n√∫t "V·∫Ω ch·ªØ"
            canvas.style.display = 'block';
        }

        canvas.addEventListener('mousedown', (e) => {
            isPainting = true;
            ctx.beginPath();
            ctx.moveTo(e.offsetX, e.offsetY);
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isPainting) return;
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.stroke();
        });

        canvas.addEventListener('mouseup', () => isPainting = false);
        canvas.addEventListener('mouseleave', () => isPainting = false);

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('preview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    document.getElementById('result').style.display = 'none';
                    document.getElementById('camera').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        function submitImage() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const canvas = document.getElementById('drawingCanvas');
            
            const formData = new FormData();
        
            if (file) {
                // N·∫øu c√≥ ·∫£nh t·∫£i l√™n, g·ª≠i ·∫£nh ƒë√≥
                formData.append("image", file);
            } else {
                // N·∫øu kh√¥ng c√≥ ·∫£nh t·∫£i l√™n, l·∫•y d·ªØ li·ªáu t·ª´ canvas v·∫Ω
                const context = canvas.getContext('2d');
                const isCanvasEmpty = !context.getImageData(0, 0, canvas.width, canvas.height).data.some(channel => channel !== 0);
        
                if (isCanvasEmpty) {
                    alert("Vui l√≤ng t·∫£i ·∫£nh ho·∫∑c v·∫Ω ch·ªØ!");
                    return;
                }
        
                canvas.toBlob(blob => {
                    formData.append("image", blob, "drawing.png");
        
                    fetchAndDisplayResult(formData);
                });
                return; // Tr√°nh g·ª≠i request 2 l·∫ßn
            }
        
            fetchAndDisplayResult(formData);
        }
        
        // H√†m g·ª≠i request ƒë·∫øn server v√† hi·ªÉn th·ªã k·∫øt qu·∫£
        function fetchAndDisplayResult(formData) {
            fetch("/upload", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.result) {
                    document.getElementById('result-content').innerText = data.result;
                    document.getElementById('result').style.display = 'block';
                } else {
                    alert("L·ªói: " + (data.error || "Kh√¥ng th·ªÉ nh·∫≠n di·ªán ch·ªØ vi·∫øt!"));
                }
            })
            .catch(error => {
                console.error("L·ªói:", error);
                alert("C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i!");
            });
        }
        

        function toggleMenu() {
            const menu = document.getElementById('menu');
            menu.classList.toggle('hidden');
        }
        function exportToFile() {
            const resultContent = document.getElementById('result-content').innerText;
            
            if (!resultContent.trim()) {
                alert("Kh√¥ng c√≥ n·ªôi dung ƒë·ªÉ xu·∫•t!");
                return;
            }
        
            const blob = new Blob([resultContent], { type: "text/plain" });
            const link = document.createElement("a");
        
            link.href = URL.createObjectURL(blob);
            link.download = "ket_qua_nhan_dien.txt"; // T√™n file xu·∫•t ra
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
    </script>
</body>
</html>